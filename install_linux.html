<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ISCE: Installing ISCE on Centos 7.5 / Ubuntu 18.04</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">ISCE
   &#160;<span id="projectnumber">3.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Installing ISCE on Centos 7.5 / Ubuntu 18.04 </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#linuxpack">Installing packages using builtin package manager</a><ul><li class="level2"><a href="#centosyum">yum on Centos 7.5</a></li>
<li class="level2"><a href="#ubuntuapt">apt-get on Ubuntu 18.04</a></li>
</ul>
</li>
<li class="level1"><a href="#conda">Installing Anaconda and Python packages</a></li>
<li class="level1"><a href="#pyreinstall">Installing pyre</a><ul><li class="level2"><a href="#pyresrc">Option 1: Install pyre from source</a></li>
<li class="level2"><a href="#pyrebin">Option 2: Install pyre binaries (warning: currently not available)</a></li>
</ul>
</li>
<li class="level1"><a href="#isce3linux">Install ISCE from source</a><ul><li class="level2"><a href="#isce3targit">Step 1: Get latest version of ISCE source</a><ul><li class="level3"><a href="#isce3git">Option 1: Checkout latest version from git</a></li>
<li class="level3"><a href="#isce3tar">Option 2: Get the latest tarball</a></li>
</ul>
</li>
<li class="level2"><a href="#isce3build">Step 2: Build the software</a></li>
<li class="level2"><a href="#isce3install">Step 3: Install and set environment variables</a></li>
</ul>
</li>
<li class="level1"><a href="#tips">Additional installation tips</a><ul><li class="level2"><a href="#tips_cuda">1. Set TMP_DIR for compilation of CUDA extensions</a></li>
</ul>
</li>
</ul>
</div>
<div class="textblock"><p>ISCE has the following dependencies </p><ol>
<li>
<a href="http://pyre.orthologue.com">pyre</a> </li>
<li>
C++ compiler - gcc-6 or above </li>
<li>
Python 3.6 or above </li>
<li>
Numpy and Cython </li>
<li>
GDAL 2.3 or above with Python bindings </li>
<li>
HDF5 1.10.2 or above with h5py </li>
<li>
cmake 3.11 or above </li>
<li>
CUDA 9.0 or above (for GPU-based processing) </li>
</ol>
<p>Centos 7.5 is the operational OS for the NISAR processing system and this is probably the most tested set of instructions. The instructions for Centos 7.5 / Ubuntu 18.04 are more or less the same except for the parts specific to using the standard package managers to install compilers and some basic packages. Our overall strategy for directory layouts is as follows:</p>
<a class="anchor" id="multi_row"></a>
<table class="doxtable">
<caption>Assumed directory structure for installation</caption>
<tr>
<th>Path</th><th>Description </th></tr>
<tr>
<td>${HOME}/python/miniconda3</td><td>Miniconda3 installation directory </td></tr>
<tr>
<td>${HOME}/src</td><td>Directory for downloading pyre and ISCE source </td></tr>
<tr>
<td>${HOME}/tools</td><td>Directory for installing pyre and ISCE </td></tr>
</table>
<h1><a class="anchor" id="linuxpack"></a>
Installing packages using builtin package manager</h1>
<h2><a class="anchor" id="centosyum"></a>
yum on Centos 7.5</h2>
<p>This section only applies to installation on Centos 7.5. The following packages and their dependencies should be installed using "yum". </p><ol>
<li>
curl </li>
<li>
sudo </li>
<li>
bzip2 </li>
<li>
zip </li>
<li>
centos-release-scl-rh </li>
<li>
yum-utils </li>
<li>
devtoolset-6-make </li>
<li>
devtoolset-6-binutils </li>
<li>
devtoolset-6-gcc </li>
<li>
devtoolset-6-gcc-gfortran </li>
<li>
devtoolset-6-gcc-c++ </li>
</ol>
<p>If CUDA support is desired, install the following set of packages with yum as well: </p><ol>
<li>
cuda-libraries-dev-9.1 </li>
<li>
cuda-nvml-dev-9.1 </li>
<li>
cuda-minimal-build-9.1 </li>
<li>
cuda-command-line-tools-9.1 </li>
</ol>
<p>Don't forget to activate the devtoolset by running the following command. </p><div class="fragment"><div class="line">&gt; source /opt/rh/devtoolset-6/enable</div></div><!-- fragment --><h2><a class="anchor" id="ubuntuapt"></a>
apt-get on Ubuntu 18.04</h2>
<p>This section only applies to installation on Ubuntu 18.04. The following packages and their dependencies should be installed using "apt-get". </p><ol>
<li>
gnupg2 </li>
<li>
curl </li>
<li>
ca-certificates </li>
<li>
bzip2 </li>
<li>
zip </li>
<li>
gcc-6 </li>
<li>
g++-6 </li>
</ol>
<p>If CUDA support is desired, install the following set of packages with apt-get as well: </p><ol>
<li>
nvidia-cuda-toolkit </li>
</ol>
<h1><a class="anchor" id="conda"></a>
Installing Anaconda and Python packages</h1>
<p>In this set of instructions, we rely on <a href="https://anaconda.org/">Anaconda</a> for installing Python dependencies. We will install Python3 to the location ${HOME}/python/miniconda3. We recommend that users install packages only from the default Anaconda channel (e.g., not from conda-forge) in order to avoid C++ linking conflicts during compilation of pyre and ISCE.</p>
<ol>
<li>
<p class="startli">We will list all the required packages in a text file called "requirements.txt" located under /home/tools/python. The contents of the requirements.txt file is shown below:</p>
<pre class="fragment">cmake
cython
gdal
git
h5py
libgdal
pytest
numpy
fftw
</pre><p class="endli"></p>
</li>
<li>
<p class="startli">We can then install Anaconda and these requirements as shown below: </p><div class="fragment"><div class="line">&gt; cd ${HOME}/python</div><div class="line">&gt; curl -sSL https://repo.continuum.io/miniconda/Miniconda3-latest-Linux-x86_64.sh -o miniconda.sh</div><div class="line">&gt; bash miniconda.sh -b -p ${HOME}/python/miniconda3</div><div class="line">&gt; touch ${HOME}/python/miniconda3/conda-meta/pinned</div><div class="line">&gt; export PATH=${HOME}/python/miniconda3/bin:$PATH</div><div class="line">&gt; export LD_LIBRARY_PATH=${HOME}/python/miniconda3/lib:$LD_LIBRARY_PATH</div><div class="line">&gt; conda config --set show_channel_urls True</div><div class="line">&gt; conda update --all</div><div class="line">&gt; conda install --file ${HOME}/python/requirements.txt</div></div><!-- fragment --><p class="endli"></p>
</li>
<li>
(Optional) On some systems, it may be necessary to activate the conda root environment in order to export important environment variables used by make, cmake, etc. To activate the environment, use: <pre class="fragment">&gt; . ${HOME}/python/miniconda3/bin/activate root
</pre> </li>
</ol>
<h1><a class="anchor" id="pyreinstall"></a>
Installing pyre</h1>
<h2><a class="anchor" id="pyresrc"></a>
Option 1: Install pyre from source</h2>
<p>In order to install pyre from source, we must first download the config package which is a Python-based build system built on top of GNU <code>make</code>. </p><div class="fragment"><div class="line">&gt; cd ${HOME}/tools</div><div class="line">&gt; git clone https://github.com/aivazis/config.git</div></div><!-- fragment --><p> In order to use config, it is recommended to add the following aliases to the startup files for your shell: </p><div class="fragment"><div class="line">alias mm=&#39;python3 ${HOME}/tools/config/make/mm.py&#39;</div><div class="line">alias mm.env=&#39;mm --env=sh&#39;</div><div class="line">alias mm.show=&#39;mm --show --dry&#39;</div><div class="line">alias mm.bldroot=&#39;mm --dry --quiet --show=BLD_ROOT&#39;</div><div class="line"></div><div class="line">mm.paths() {</div><div class="line">    # get {mm} to print out the path variables and add them to the current environment</div><div class="line">    eval $(python3 ${HOME}/tools/config/make/mm.py --quiet --paths=sh $*)</div><div class="line">}</div></div><!-- fragment --><p> Additionally, we would like to control where pyre get installed: </p><div class="fragment"><div class="line">&gt; cd ~</div><div class="line">&gt; mkdir .mm</div><div class="line">&gt; cd .mm</div><div class="line">&gt; vi username.py</div></div><!-- fragment --><p> where <code>username.py</code> is replaced with your username. The contents of the file are as follows: </p><div class="fragment"><div class="line"><span class="comment"># support</span></div><div class="line"><span class="keyword">import</span> os</div><div class="line"></div><div class="line"><span class="comment"># adjust the {builder} with {developer} choices</span></div><div class="line"><span class="keyword">def </span>developer(builder):</div><div class="line">    <span class="stringliteral">&quot;&quot;&quot;</span></div><div class="line"><span class="stringliteral">    Decorate the builder with developer specific choices</span></div><div class="line"><span class="stringliteral">    &quot;&quot;&quot;</span></div><div class="line">    <span class="comment"># get the developer name</span></div><div class="line">    user = builder.user</div><div class="line">    <span class="comment"># place temporary build files in my &#39;tmp&#39; directory</span></div><div class="line">    builder.bldroot = os.path.join(user.home, <span class="stringliteral">&#39;tmp&#39;</span>, <span class="stringliteral">&#39;builds&#39;</span>)</div><div class="line">    <span class="comment"># and the products in my &#39;tools/pyre&#39; directory</span></div><div class="line">    builder.prefix = os.path.join(user.home, <span class="stringliteral">&#39;tools&#39;</span>, <span class="stringliteral">&#39;pyre&#39;</span>)</div><div class="line"></div><div class="line"><span class="comment"># all done</span></div><div class="line"><span class="keywordflow">return</span> builder</div></div><!-- fragment --><p> Then, we can download the pyre source. </p><div class="fragment"><div class="line">&gt; cd ~</div><div class="line">&gt; mkdir src</div><div class="line">&gt; cd src</div><div class="line">&gt; git clone https://github.com/pyre/pyre.git</div><div class="line">&gt; cd pyre</div></div><!-- fragment --><p> For the most basic pyre build, we must point config to the Python we wish to use (in this case, the Python included with our Miniconda distribution). To do this, once we are in the pyre source directory, we create a file <code>.mm/config.def</code> with the following content (modify for Python 3.6 if needed): </p><div class="fragment"><div class="line">PYTHON = python3.7m</div><div class="line">PYTHON_DIR = ${HOME}/python/miniconda3</div><div class="line">PYTHON_INCDIR = $(PYTHON_DIR)/include/python3.7m</div><div class="line">PYTHON_LIB = python3.7m</div><div class="line">PYTHON_LIBDIR = $(PYTHON_DIR)/lib</div><div class="line">PYTHON_PYCFLAGS = -b</div></div><!-- fragment --><p> At the moment, we need to comment out one set of tests that fails for several platforms. Run the following command from the top-level directory: </p><div class="fragment"><div class="line">sed -i &#39;s|externals|#externals|g&#39; tests/pyre/Make.mm</div></div><!-- fragment --><p> Finally, we can install pyre with the following command: </p><div class="fragment"><div class="line">&gt; mm</div></div><!-- fragment --><p> If the conda root environment has been activated (see optional Step 3 in the previous section), then there may be a conflict with the environment variable <code>PROJ_LIB</code> and <code>mm</code>. In that case, run <code>mm</code> in the following manner: </p><div class="fragment"><div class="line">&gt; PROJ_LIB=&#39;&#39; mm</div></div><!-- fragment --><p> Once installation and testing is complete, we setup the following environment variables: </p><div class="fragment"><div class="line">export PYREDIR=${HOME}/tools/pyre</div><div class="line">export PATH=$PYREDIR/bin:$PATH</div><div class="line">export PYTHONPATH=$PYREDIR/packages:$PYTHONPATH</div><div class="line">export LD_LIBRARY_PATH=$PYREDIR/lib:$LD_LIBRARY_PATH</div></div><!-- fragment --><h2><a class="anchor" id="pyrebin"></a>
Option 2: Install pyre binaries (warning: currently not available)</h2>
<p>If pre-built pyre binaries are available, we can simply download the binaries and install them in the correct location. We will install pyre binaries in ${HOME}/tools/pyre.</p>
<ol>
<li>
<p class="startli">Download the pyre binaries. </p><div class="fragment"><div class="line">&gt; cd ${HOME}/tools</div><div class="line">&gt; curl -sSL http://pyre.orthologue.com/pyre-1.0.cpython-36m-x86_64-linux-gnu.zip -o pyre.zip</div></div><!-- fragment --><p class="endli"></p>
</li>
<li>
<p class="startli">Unzip the zip file. </p><div class="fragment"><div class="line">&gt; cd ${HOME}/tools</div><div class="line">&gt; mkdir pyre</div><div class="line">&gt; cd pyre</div><div class="line">&gt; unzip ../pyre.zip</div></div><!-- fragment --><p class="endli"></p>
</li>
<li>
<p class="startli">Setup relevant environment variables </p><div class="fragment"><div class="line">export PYREDIR=${HOME}/tools/pyre</div><div class="line">export PATH=$PYREDIR/bin:$PATH</div><div class="line">export PYTHONPATH=$PYREDIR/packages:$PYTHONPATH</div><div class="line">export LD_LIBRARY_PATH=$PYREDIR/lib:$LD_LIBRARY_PATH</div></div><!-- fragment --><p class="endli"></p>
</li>
</ol>
<h1><a class="anchor" id="isce3linux"></a>
Install ISCE from source</h1>
<p>In this section we will walk through the directory setup and build system instructions for installing ISCE. ISCE can be built with 2 different build systems - <a href="https://github.com/aivazis/config">mm</a> and <a href="https://cmake.org/">cmake</a>. In this set of instructions, we focus on cmake as it is already available via standard package managers.</p>
<h2><a class="anchor" id="isce3targit"></a>
Step 1: Get latest version of ISCE source</h2>
<h3><a class="anchor" id="isce3git"></a>
Option 1: Checkout latest version from git</h3>
<ol>
<li>
Ensure that you are in the source folder <div class="fragment"><div class="line">&gt; cd ${HOME}/src</div></div><!-- fragment --> </li>
<li>
Check out the latest version of the source code from git <div class="fragment"><div class="line">&gt; git clone https://github-fn.jpl.nasa.gov/ericmg/isce</div></div><!-- fragment --> </li>
<li>
Ensure you are building the branch that you want to use. For example, if you want to build the <b>develop</b> branch <div class="fragment"><div class="line">&gt; cd isce</div><div class="line">&gt; git checkout develop</div></div><!-- fragment --> </li>
</ol>
<h3><a class="anchor" id="isce3tar"></a>
Option 2: Get the latest tarball</h3>
<ol>
<li>
Ensure that you are in the source folder <div class="fragment"><div class="line">&gt; cd ${HOME}/src</div></div><!-- fragment --> </li>
<li>
Unpack the tarball. <div class="fragment"><div class="line">&gt; tar xjbf isce.tar.bz2</div></div><!-- fragment --> </li>
</ol>
<h2><a class="anchor" id="isce3build"></a>
Step 2: Build the software</h2>
<ol>
<li>
<p class="startli">For our cmake build, we follow the practice of building outside of the source parent directory. To that end, we first create a temporary build directory: </p><div class="fragment"><div class="line">&gt; cd ${HOME}/src/isce</div><div class="line">&gt; mkdir build</div><div class="line">&gt; cd build</div></div><!-- fragment --><p class="endli"></p>
</li>
<li>
<p class="startli">Ensure that you have activated the scl environment (Centos), conda and set environment variables needed by pyre following instructions provided above. Note: for some operating systems, if you wish to build the CUDA extensions, you may need to run </p><div class="fragment"><div class="line">export CUDACXX=/usr/local/cuda/bin/nvcc</div></div><!-- fragment --><p class="endli"></p>
</li>
<li>
<p class="startli">Run cmake with the correct inputs </p><div class="fragment"><div class="line">&gt; CC=gcc CXX=g++ cmake -DCMAKE_INSTALL_PREFIX=${HOME}/tools/isce ${HOME}/src/isce</div></div><!-- fragment --><p>Other optional arguments can be added to the cmake line </p><a class="anchor" id="multi_row"></a>
<table class="doxtable">
<caption>Additional cmake options</caption>
<tr>
<th>Option </th><th>Description </th></tr>
<tr>
<td>-DWITH_CUDA=ON </td><td>Build with CUDA support (will need CUDA libraries installed) </td></tr>
<tr>
<td>-DWITH_DOC=ON </td><td>Build documentation from code using doxygen and sphinx. These need to be installed. </td></tr>
<tr>
<td rowspan="3">-DMEMORY_CHECK_COMMAND=PATH_TO_VALGRIND_EXECUTABLE -DMEMORYCHECK_COMMAND_OPTIONS="--trace-children=yes --leak-check=full --track-origins=yes" -DCMAKE_BUILD_TYPE=Debug</td><td><br />
 </td></tr>
<tr>
<td>Run tests with "-T memcheck" to check for memory leaks. </td></tr>
<tr>
<td>valgrind needs to be installed. </td></tr>
<tr>
<td>-DPYTHON_EXECUTABLE:FILENAME=&lt;path_to_python_exe&gt;</td><td>Pass this argument if installing to a python virtual environment </td></tr>
</table>
<p class="endli"></p>
</li>
<li>
<p class="startli">Build the software </p><div class="fragment"><div class="line">&gt; make VERBOSE=ON</div></div><!-- fragment --><p class="endli"></p>
</li>
<li>
Run the unit tests to ensure that software was built correctly <div class="fragment"><div class="line">&gt; ctest</div></div><!-- fragment --> </li>
</ol>
<h2><a class="anchor" id="isce3install"></a>
Step 3: Install and set environment variables</h2>
<ol>
<li>
<p class="startli">Ensure that you are in the build folder </p><div class="fragment"><div class="line">&gt; cd ${HOME}/src/isce/build</div></div><!-- fragment --><p class="endli"></p>
</li>
<li>
<p class="startli">Install the software </p><div class="fragment"><div class="line">&gt; make install</div></div><!-- fragment --><p class="endli"></p>
</li>
<li>
<p class="startli">Setup the environment variables. Note that these need to be done in addition to the settings needed for scl (Centos), conda and pyre.</p>
<a class="anchor" id="multi_row"></a>
<table class="doxtable">
<caption>Environment variables to set after installing ISCE</caption>
<tr>
<th>Variable</th><th>Setting</th><th>Description </th></tr>
<tr>
<td>PATH</td><td>$PATH:${HOME}/tools/isce/bin</td><td>For executables installed by ISCE </td></tr>
<tr>
<td>PYTHONPATH</td><td>$PYTHONPATH:${HOME}/tools/isce/packages</td><td>ISCE python package </td></tr>
<tr>
<td>LD_LIBRARY_PATH</td><td>$LD_LIBRARY_PATH:${HOME}/tools/isce/lib</td><td>Shared libraries built by ISCE </td></tr>
</table>
<p>We also recommend setting these environment variables in your appropriate <code>.bashrc</code> or <code>.bash_profile</code> file to avoid having to set them for each new session. For example:</p>
<div class="fragment"><div class="line"># .bash_profile</div><div class="line"></div><div class="line"># Get the aliases and functions</div><div class="line">if [ -f ~/.bashrc ]; then</div><div class="line">. ~/.bashrc</div><div class="line">fi</div><div class="line"></div><div class="line"># User specific environment and startup programs</div><div class="line"></div><div class="line"># miniconda3</div><div class="line">export PATH=${HOME}/python/miniconda3/bin:$PATH</div><div class="line">export LD_LIBRARY_PATH=${HOME}/python/miniconda3/lib:$LD_LIBRARY_PATH</div><div class="line"></div><div class="line"># cuda</div><div class="line">export CUDACXX=/usr/local/cuda/bin/nvcc</div><div class="line"></div><div class="line"># pyre</div><div class="line">export PYREDIR=${HOME}/tools/pyre</div><div class="line">export PATH=$PYREDIR/bin:$PATH</div><div class="line">export PYTHONPATH=$PYREDIR/packages:$PYTHONPATH</div><div class="line">export LD_LIBRARY_PATH=$PYREDIR/lib:$LD_LIBRARY_PATH</div><div class="line"></div><div class="line"># isce</div><div class="line">export PATH=$PATH:${HOME}/tools/isce/bin</div><div class="line">export PYTHONPATH=$PYTHONPATH:${HOME}/tools/isce/packages</div><div class="line">export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:${HOME}/tools/isce/lib</div></div><!-- fragment --><p class="endli"></p>
</li>
</ol>
<h1><a class="anchor" id="tips"></a>
Additional installation tips</h1>
<p>During the installation process, users may need to implement additional steps depending on their operating system, prerequisites, development environment, etc.</p>
<h2><a class="anchor" id="tips_cuda"></a>
1. Set TMP_DIR for compilation of CUDA extensions</h2>
<p>During compilation of CUDA extensions with nvcc and cmake, temporary files are placed in <code>/tmp</code> or the directory pointed to by the environment variable <code>TMP_DIR</code>. Therefore, if users wish to place temporary files in a custom directory, they must set <code>TMP_DIR</code>. </p>
</div></div><!-- contents -->
<hr>
Generated for ISCE3.0 by
<a href="http://www.doxygen.org/index.html"><img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.8.14.
</body>
</html>
